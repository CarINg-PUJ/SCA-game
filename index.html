<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador SCA - Hospital Virtual</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 900px;
            width: 100%;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .timer-bar {
            background: rgba(255,255,255,0.2);
            height: 40px;
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            margin-top: 15px;
        }

        .timer-fill {
            background: linear-gradient(90deg, #2ecc71, #f1c40f, #e74c3c);
            height: 100%;
            width: 100%;
            transition: width 1s linear;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }

        .patient-info {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 2px solid #dee2e6;
        }

        .vital-signs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .vital-sign {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .vital-sign .label {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .vital-sign .value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }

        .vital-sign.critical {
            background: #ffe5e5;
            border: 2px solid #e74c3c;
        }

        .vital-sign.critical .value {
            color: #e74c3c;
        }

        .game-content {
            padding: 30px;
        }

        .scenario {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 5px;
        }

        .scenario h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .scenario.nstemi {
            background: #d1ecf1;
            border-left-color: #17a2b8;
        }

        .scenario.nstemi h3 {
            color: #0c5460;
        }

        .ecg-container {
            background: #2c3e50;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .ecg-image {
            background: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
            color: #e74c3c;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: monospace;
        }

        .options {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .option-btn {
            background: white;
            border: 2px solid #3498db;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            font-size: 16px;
        }

        .option-btn:hover {
            background: #3498db;
            color: white;
            transform: translateX(5px);
        }

        .option-btn.correct {
            background: #2ecc71;
            color: white;
            border-color: #27ae60;
        }

        .option-btn.incorrect {
            background: #e74c3c;
            color: white;
            border-color: #c0392b;
        }

        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        .feedback {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            display: none;
        }

        .feedback.show {
            display: block;
        }

        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .score-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .score {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }

        .progress {
            font-size: 16px;
            color: #6c757d;
        }

        .next-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
            display: none;
            transition: transform 0.3s;
        }

        .next-btn:hover {
            transform: scale(1.05);
        }

        .next-btn.show {
            display: inline-block;
        }

        .game-over {
            text-align: center;
            padding: 40px;
            display: none;
        }

        .game-over.show {
            display: block;
        }

        .game-over h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 32px;
        }

        .final-score {
            font-size: 48px;
            color: #3498db;
            margin: 20px 0;
            font-weight: bold;
        }

        .restart-btn {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 18px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .restart-btn:hover {
            transform: scale(1.05);
        }

        .achievement {
            background: #ffd700;
            color: #2c3e50;
            padding: 10px 20px;
            border-radius: 20px;
            display: inline-block;
            margin: 10px 5px;
            font-weight: bold;
        }

        .case-type {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .stemi {
            background: #ffebee;
            color: #c62828;
            border: 2px solid #ef5350;
        }

        .nstemi {
            background: #e1f5fe;
            color: #01579b;
            border: 2px solid #29b6f6;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>üè• Simulador de S√≠ndromes Coronarios Agudos</h1>
            <p>Protocolo STEMI/NSTEMI - AHA Guidelines 2025</p>
            <div class="timer-bar">
                <div class="timer-fill" id="timerFill">
                    <span id="timerText">Tiempo: 120 min</span>
                </div>
            </div>
        </div>

        <div class="patient-info" id="patientInfo">
            <h3>üë§ Informaci√≥n del Paciente</h3>
            <p id="patientDetails"></p>
            <div class="vital-signs" id="vitalSigns"></div>
        </div>

        <div class="game-content">
            <div id="gameArea">
                <!-- Contenido din√°mico del juego -->
            </div>

            <div class="score-container">
                <div class="score">Puntuaci√≥n: <span id="score">0</span></div>
                <div class="progress">Pregunta: <span id="currentStage">1</span> / <span id="totalStages">10</span></div>
            </div>

            <button class="next-btn" id="nextBtn" onclick="nextStage()">Siguiente Pregunta ‚Üí</button>
        </div>

        <div class="game-over" id="gameOver">
            <h2>üéâ ¬°Simulaci√≥n Completada!</h2>
            <div class="final-score" id="finalScore"></div>
            <div id="achievements"></div>
            <p id="finalMessage"></p>
            <button class="restart-btn" onclick="restartGame()">Nueva Simulaci√≥n</button>
        </div>
    </div>

    <script>
        // Estado del juego
        let gameState = {
            score: 0,
            currentStage: 0,
            totalTime: 120,
            timeRemaining: 120,
            timerInterval: null,
            answeredCorrectly: [],
            patient: null,
            selectedQuestions: []
        };

        // Datos de pacientes
        const patients = [
            {
                name: "Juan P√©rez", age: 58, gender: "Masculino",
                symptoms: "Dolor tor√°cico opresivo de 45 minutos, sudoraci√≥n",
                vitals: {
                    'FC': { value: '110 lpm', critical: true },
                    'PA': { value: '90/60 mmHg', critical: true },
                    'SatO2': { value: '92%', critical: true },
                    'Temp': { value: '36.5¬∞C', critical: false }
                }
            },
            {
                name: "Mar√≠a Gonz√°lez", age: 65, gender: "Femenino",
                symptoms: "Dolor tor√°cico at√≠pico, n√°useas, fatiga",
                vitals: {
                    'FC': { value: '95 lpm', critical: false },
                    'PA': { value: '140/90 mmHg', critical: false },
                    'SatO2': { value: '94%', critical: false },
                    'Temp': { value: '36.8¬∞C', critical: false }
                }
            },
            {
                name: "Carlos Ruiz", age: 72, gender: "Masculino",
                symptoms: "Disnea y molestias tor√°cicas leves de 6 horas",
                vitals: {
                    'FC': { value: '88 lpm', critical: false },
                    'PA': { value: '160/95 mmHg', critical: false },
                    'SatO2': { value: '96%', critical: false },
                    'Temp': { value: '37¬∞C', critical: false }
                }
            }
        ];

        // Banco de 30 preguntas (STEMI y NSTEMI)
        const questionBank = [
            // STEMI Questions (15)
            {
                title: "Evaluaci√≥n Inicial STEMI", type: "stemi",
                scenario: "Paciente con dolor tor√°cico intenso de inicio s√∫bito hace 30 minutos",
                ecg: "‚ö° ECG: Elevaci√≥n del ST >2mm en V1-V4 (STEMI anterior) ‚ö°",
                question: "¬øCu√°l es tu primera acci√≥n seg√∫n AHA 2025?",
                options: [
                    { text: "ECG de 12 derivaciones en <10 minutos", correct: true, feedback: "Correcto! ECG <10min es clase I AHA 2025" },
                    { text: "Troponinas inmediatas", correct: false, feedback: "El ECG tiene prioridad absoluta" },
                    { text: "Rx t√≥rax", correct: false, feedback: "No retrasar ECG por imagen" },
                    { text: "TC tor√°cico", correct: false, feedback: "ECG es la prioridad" }
                ]
            },
            {
                title: "Protocolo MONA STEMI", type: "stemi",
                scenario: "STEMI confirmado, dolor 9/10, SatO2 88%",
                ecg: "‚ö° STEMI inferior (II, III, aVF) ‚ö°",
                question: "¬øProtocolo MONA correcto seg√∫n AHA 2025?",
                options: [
                    { text: "Morfina PRN + O2 si SatO2<90% + Nitroglicerina + ASA 325mg", correct: true, feedback: "Perfecto! MONA actualizado AHA 2025" },
                    { text: "Morfina + O2 100% + Nitroglicerina + ASA", correct: false, feedback: "O2 solo si SatO2<90%" },
                    { text: "Solo analgesia", correct: false, feedback: "Protocolo incompleto" },
                    { text: "MONA sin morfina", correct: false, feedback: "Morfina PRN para dolor severo" }
                ]
            },
            {
                title: "Tiempo Puerta-Bal√≥n", type: "stemi",
                scenario: "STEMI con s√≠ntomas de 1 hora, hospital con ICP disponible",
                ecg: "‚ö° STEMI anterior extenso ‚ö°",
                question: "¬øTiempo objetivo puerta-bal√≥n AHA 2025?",
                options: [
                    { text: "<90 minutos", correct: true, feedback: "Correcto! Meta <90min para ICP primaria" },
                    { text: "<120 minutos", correct: false, feedback: "Muy tard√≠o para ICP primaria" },
                    { text: "<60 minutos", correct: false, feedback: "Ideal pero no siempre realista" },
                    { text: "<180 minutos", correct: false, feedback: "Inaceptablemente tard√≠o" }
                ]
            },
            {
                title: "Fibrin√≥lisis vs ICP", type: "stemi",
                scenario: "STEMI, hospital sin ICP, transferencia tomar√≠a 3 horas",
                ecg: "‚ö° STEMI de 2 horas de evoluci√≥n ‚ö°",
                question: "¬øEstrategia de reperfusi√≥n √≥ptima?",
                options: [
                    { text: "Fibrin√≥lisis inmediata", correct: true, feedback: "Correcto! Si transferencia >120min, fibrin√≥lisis" },
                    { text: "Transferir para ICP", correct: false, feedback: "Tiempo excesivo, >120min" },
                    { text: "Tratamiento m√©dico", correct: false, feedback: "Reperfusi√≥n es mandatoria" },
                    { text: "Esperar 6 horas", correct: false, feedback: "Ventana terap√©utica cr√≠tica" }
                ]
            },
            {
                title: "Contraindicaciones Fibrin√≥lisis", type: "stemi",
                scenario: "STEMI, paciente con ACV hemorr√°gico hace 2 meses",
                ecg: "‚ö° STEMI lateral (I, aVL, V5-V6) ‚ö°",
                question: "¬øConducta apropiada?",
                options: [
                    { text: "ICP primaria urgente", correct: true, feedback: "Correcto! ACV hemorr√°gico contraindica fibrin√≥lisis" },
                    { text: "Fibrin√≥lisis con alteplase", correct: false, feedback: "Contraindicaci√≥n absoluta" },
                    { text: "Tratamiento m√©dico conservador", correct: false, feedback: "Requiere reperfusi√≥n" },
                    { text: "Fibrin√≥lisis con reteplase", correct: false, feedback: "Cualquier fibrinol√≠tico est√° contraindicado" }
                ]
            },
            {
                title: "Antiagregaci√≥n Dual STEMI", type: "stemi",
                scenario: "STEMI, preparando ICP primaria",
                ecg: "‚ö° STEMI posterior (V7-V9) ‚ö°",
                question: "¬øAntiagregaci√≥n dual √≥ptima pre-ICP?",
                options: [
                    { text: "ASA 325mg + Ticagrelor 180mg", correct: true, feedback: "Perfecto! DAPT potente para STEMI" },
                    { text: "ASA 81mg + Clopidogrel 75mg", correct: false, feedback: "Dosis insuficientes para agudo" },
                    { text: "Solo ASA 325mg", correct: false, feedback: "Monoterapia insuficiente" },
                    { text: "ASA + Prasugrel 10mg", correct: false, feedback: "Dosis de Prasugrel incorrecta" }
                ]
            },
            {
                title: "STEMI en Diab√©tico", type: "stemi",
                scenario: "STEMI en diab√©tico de 68 a√±os, sin contraindicaciones",
                ecg: "‚ö° STEMI anterior con Q patol√≥gicas ‚ö°",
                question: "¬øInhibidor P2Y12 preferido seg√∫n AHA 2025?",
                options: [
                    { text: "Ticagrelor 180mg carga", correct: true, feedback: "Correcto! Ticagrelor preferido en diab√©ticos" },
                    { text: "Prasugrel 60mg carga", correct: false, feedback: "Ticagrelor mejor evidencia en diab√©ticos" },
                    { text: "Clopidogrel 600mg", correct: false, feedback: "Menos potente en diab√©ticos" },
                    { text: "Cangrelor IV", correct: false, feedback: "No primera l√≠nea" }
                ]
            },
            {
                title: "Shock Cardiog√©nico STEMI", type: "stemi",
                scenario: "STEMI con PA 70/40, frialdad distal, lactato 4.5",
                ecg: "‚ö° STEMI anterior extenso + shock ‚ö°",
                question: "¬øManejo inicial prioritario?",
                options: [
                    { text: "ICP primaria URGENTE + soporte hemodin√°mico", correct: true, feedback: "Correcto! Revascularizaci√≥n urgente es clave" },
                    { text: "Estabilizar primero, luego ICP", correct: false, feedback: "ICP urgente mejora supervivencia" },
                    { text: "IABP primero", correct: false, feedback: "ICP tiene prioridad" },
                    { text: "Solo soporte m√©dico", correct: false, feedback: "Revascularizaci√≥n es vital" }
                ]
            },
            {
                title: "STEMI en Anciano >80 a√±os", type: "stemi",
                scenario: "STEMI en mujer de 85 a√±os, independiente, buena calidad de vida",
                ecg: "‚ö° STEMI inferior con bloqueo AV ‚ö°",
                question: "¬øEstrategia de reperfusi√≥n?",
                options: [
                    { text: "ICP primaria (edad no es contraindicaci√≥n)", correct: true, feedback: "Correcto! Edad sola no contraindica ICP" },
                    { text: "Solo tratamiento m√©dico", correct: false, feedback: "Discriminaci√≥n por edad inapropiada" },
                    { text: "Fibrin√≥lisis preferible", correct: false, feedback: "Mayor riesgo hemorr√°gico en ancianos" },
                    { text: "Cuidados paliativos", correct: false, feedback: "Paciente con buena funcionalidad" }
                ]
            },
            {
                title: "Rescate post-Fibrin√≥lisis", type: "stemi",
                scenario: "Post-fibrin√≥lisis, dolor persiste, ST sin resoluci√≥n >50% a los 90min",
                ecg: "‚ö° ST persistentemente elevado post-l√≠ticos ‚ö°",
                question: "¬øSiguiente paso seg√∫n AHA 2025?",
                options: [
                    { text: "ICP de rescate inmediata", correct: true, feedback: "Correcto! Fibrin√≥lisis fallida requiere ICP rescate" },
                    { text: "Segunda dosis de fibrinol√≠tico", correct: false, feedback: "No recomendado, aumenta riesgo" },
                    { text: "Esperar 24 horas", correct: false, feedback: "P√©rdida de tiempo cr√≠tico" },
                    { text: "Solo anticoagulaci√≥n", correct: false, feedback: "Reperfusi√≥n mec√°nica necesaria" }
                ]
            },
            {
                title: "Anticoagulaci√≥n STEMI-ICP", type: "stemi",
                scenario: "STEMI programado para ICP primaria inmediata",
                ecg: "‚ö° Preparaci√≥n para cateterismo ‚ö°",
                question: "¬øAnticoagulaci√≥n para ICP seg√∫n AHA 2025?",
                options: [
                    { text: "Heparina no fraccionada IV", correct: true, feedback: "Correcto! HNF est√°ndar para ICP primaria" },
                    { text: "Enoxaparina SC", correct: false, feedback: "HNF preferida para ICP" },
                    { text: "Rivaroxab√°n", correct: false, feedback: "DOAC no para fase aguda" },
                    { text: "Sin anticoagulaci√≥n", correct: false, feedback: "Anticoagulaci√≥n esencial" }
                ]
            },
            {
                title: "Complicaci√≥n Mec√°nica STEMI", type: "stemi",
                scenario: "Post-STEMI d√≠a 3, soplo holosist√≥lico nuevo, deterioro hemodin√°mico",
                ecg: "‚ö° Q patol√≥gicas anteriores ‚ö°",
                question: "¬øComplicaci√≥n m√°s probable?",
                options: [
                    { text: "Insuficiencia mitral aguda/ruptura de m√∫sculo papilar", correct: true, feedback: "Correcto! Soplo + deterioro = complicaci√≥n mec√°nica" },
                    { text: "Reinfarto", correct: false, feedback: "No explica soplo nuevo" },
                    { text: "Pericarditis", correct: false, feedback: "No causa deterioro tan severo" },
                    { text: "TEP", correct: false, feedback: "No relacionado con soplo" }
                ]
            },
            {
                title: "STEMI Posterior", type: "stemi",
                scenario: "Dolor tor√°cico, ECG 12 derivaciones muestra R dominante V1-V2",
                ecg: "‚ö° R alto en V1-V2, ST depresi√≥n V1-V3 ‚ö°",
                question: "¬øSiguiente paso diagn√≥stico?",
                options: [
                    { text: "ECG posterior (V7-V9)", correct: true, feedback: "Correcto! R dominante V1-V2 sugiere STEMI posterior" },
                    { text: "Ecocardiograma", correct: false, feedback: "ECG posterior primero" },
                    { text: "Troponinas", correct: false, feedback: "ECG posterior es prioritario" },
                    { text: "TC coronario", correct: false, feedback: "ECG posterior confirma diagn√≥stico" }
                ]
            },
            {
                title: "Terapia Post-STEMI Alta", type: "stemi",
                scenario: "Post-ICP exitosa, FE 45%, sin contraindicaciones",
                ecg: "‚ö° Reperfusi√≥n exitosa, TIMI 3 ‚ö°",
                question: "¬øTerapia al alta AHA 2025?",
                options: [
                    { text: "DAPT + Estatina alta intensidad + IECA + Betabloqueador", correct: true, feedback: "Perfecto! Prevenci√≥n secundaria completa" },
                    { text: "Solo DAPT por 12 meses", correct: false, feedback: "Falta prevenci√≥n secundaria completa" },
                    { text: "DAPT + Estatina", correct: false, feedback: "Faltan IECA y betabloqueador" },
                    { text: "Solo ASA de por vida", correct: false, feedback: "Terapia muy limitada" }
                ]
            },
            {
                title: "STEMI con Fibrilaci√≥n Auricular", type: "stemi",
                scenario: "Post-STEMI con FA de novo, CHA2DS2-VASc 4 puntos",
                ecg: "‚ö° FA + stent liberador de f√°rmaco ‚ö°",
                question: "¬øTerapia antitromb√≥tica √≥ptima?",
                options: [
                    { text: "Triple terapia: DOAC + ASA + P2Y12 (duraci√≥n limitada)", correct: true, feedback: "Correcto! Triple terapia con DOAC preferido" },
                    { text: "Solo DAPT", correct: false, feedback: "Alto riesgo emb√≥lico (CHA2DS2-VASc 4)" },
                    { text: "Solo anticoagulaci√≥n", correct: false, feedback: "Riesgo de trombosis de stent" },
                    { text: "Warfarina + DAPT completo", correct: false, feedback: "DOAC preferido sobre warfarina" }
                ]
            },

            // NSTEMI Questions (15)
            {
                title: "Diagn√≥stico NSTEMI", type: "nstemi",
                scenario: "Dolor tor√°cico 4 horas, troponina elevada x3 LSN",
                ecg: "üìä ECG: ST depresi√≥n V4-V6, sin elevaci√≥n ST üìä",
                question: "¬øClasificaci√≥n seg√∫n AHA 2025?",
                options: [
                    { text: "NSTEMI (troponina+ sin elevaci√≥n ST)", correct: true, feedback: "Correcto! Troponina elevada + s√≠ntomas = NSTEMI" },
                    { text: "Angina inestable", correct: false, feedback: "Troponina elevada define NSTEMI" },
                    { text: "STEMI at√≠pico", correct: false, feedback: "No hay elevaci√≥n de ST" },
                    { text: "S√≠ndrome X", correct: false, feedback: "Troponina elevada excluye Sx X" }
                ]
            },
            {
                title: "Estratificaci√≥n Riesgo NSTEMI", type: "nstemi",
                scenario: "NSTEMI, 70 a√±os, diabetes, troponina 15 ng/mL, GRACE score 140",
                ecg: "üìä ST depresi√≥n >2mm m√∫ltiples derivaciones üìä",
                question: "¬øClasificaci√≥n de riesgo?",
                options: [
                    { text: "Alto riesgo - estrategia invasiva precoz (<24h)", correct: true, feedback: "Correcto! GRACE >140 = alto riesgo" },
                    { text: "Riesgo moderado - invasiva en 72h", correct: false, feedback: "GRACE 140 es alto riesgo" },
                    { text: "Bajo riesgo - manejo conservador", correct: false, feedback: "Multiple factores de alto riesgo" },
                    { text: "Riesgo intermedio", correct: false, feedback: "GRACE >140 define alto riesgo" }
                ]
            },
            {
                title: "Timing Invasivo NSTEMI", type: "nstemi",
                scenario: "NSTEMI alto riesgo, hemodin√°micamente estable",
                ecg: "üìä Cambios ST din√°micos üìä",
                question: "¬øTiming para estrategia invasiva seg√∫n AHA 2025?",
                options: [
                    { text: "Dentro de 24 horas", correct: true, feedback: "Correcto! Alto riesgo requiere invasiva <24h" },
                    { text: "Inmediata (<2 horas)", correct: false, feedback: "Solo si inestabilidad hemodin√°mica" },
                    { text: "Dentro de 72 horas", correct: false, feedback: "Muy tard√≠o para alto riesgo" },
                    { text: "Manejo conservador inicial", correct: false, feedback: "Alto riesgo requiere estrategia invasiva" }
                ]
            },
            {
                title: "NSTEMI con Inestabilidad", type: "nstemi",
                scenario: "NSTEMI con angina recurrente refractaria y cambios ST din√°micos",
                ecg: "üìä ST depresi√≥n fluctuante durante dolor üìä",
                question: "¬øEstrategia de timing?",
                options: [
                    { text: "Invasiva inmediata (<2 horas)", correct: true, feedback: "Correcto! Inestabilidad requiere invasiva urgente" },
                    { text: "Invasiva en 24 horas", correct: false, feedback: "Muy tard√≠o para inestabilidad" },
                    { text: "Optimizar tratamiento m√©dico primero", correct: false, feedback: "Refractario a tratamiento m√©dico" },
                    { text: "Manejo conservador", correct: false, feedback: "Inestabilidad cl√≠nica requiere intervenci√≥n" }
                ]
            },
            {
                title: "Antiagregaci√≥n NSTEMI", type: "nstemi",
                scenario: "NSTEMI programado para cateterismo en 12 horas",
                ecg: "üìä ST depresi√≥n anterior üìä",
                question: "¬øDAPT √≥ptima pre-cateterismo?",
                options: [
                    { text: "ASA + Ticagrelor (estrategia pretratamiento)", correct: true, feedback: "Correcto! Pretratamiento recomendado NSTEMI" },
                    { text: "Solo ASA hasta definir anatom√≠a", correct: false, feedback: "DAPT recomendado pre-cateterismo" },
                    { text: "ASA + esperar resultado cateterismo", correct: false, feedback: "Pretratamiento mejora resultados" },
                    { text: "ASA + Prasugrel siempre", correct: false, feedback: "Prasugrel post-cateterismo si no bypass" }
                ]
            },
            {
                title: "NSTEMI Score GRACE", type: "nstemi",
                scenario: "NSTEMI: 55 a√±os, FC 90, PA sist√≥lica 110, creatinina normal, sin parada card√≠aca",
                ecg: "üìä ST depresi√≥n m√≠nima üìä",
                question: "¬øCategor√≠a de riesgo probable?",
                options: [
                    { text: "Riesgo bajo-intermedio (GRACE <140)", correct: true, feedback: "Correcto! Perfil cl√≠nico sugiere riesgo menor" },
                    { text: "Alto riesgo (GRACE >140)", correct: false, feedback: "Perfil no sugiere alto riesgo" },
                    { text: "Riesgo muy alto", correct: false, feedback: "Sin criterios de muy alto riesgo" },
                    { text: "Imposible determinar sin score completo", correct: false, feedback: "Datos permiten estimaci√≥n aproximada" }
                ]
            },
            {
                title: "NSTEMI en Mujer", type: "nstemi",
                scenario: "Mujer 62 a√±os, s√≠ntomas at√≠picos, troponina elevada, ECG normal",
                ecg: "üìä ECG sin cambios significativos üìä",
                question: "¬øConsideraci√≥n especial seg√∫n AHA 2025?",
                options: [
                    { text: "Alto √≠ndice sospecha - s√≠ntomas at√≠picos comunes en mujeres", correct: true, feedback: "Correcto! Presentaci√≥n at√≠pica m√°s frecuente en mujeres" },
                    { text: "Baja probabilidad de SCA", correct: false, feedback: "Troponina elevada es diagn√≥stica" },
                    { text: "Mismo manejo que hombres sin diferencias", correct: false, feedback: "Hay consideraciones espec√≠ficas de g√©nero" },
                    { text: "Esperar s√≠ntomas t√≠picos", correct: false, feedback: "S√≠ntomas at√≠picos no excluyen SCA en mujeres" }
                ]
            },
            {
                title: "Anticoagulaci√≥n NSTEMI", type: "nstemi",
                scenario: "NSTEMI, estrategia invasiva planeada, sin alto riesgo hemorr√°gico",
                ecg: "üìä Cambios isqu√©micos difusos üìä",
                question: "¬øAnticoagulaci√≥n de elecci√≥n?",
                options: [
                    { text: "Enoxaparina o HNF (ambas clase I)", correct: true, feedback: "Correcto! Ambas opciones clase I AHA 2025" },
                    { text: "Solo HNF", correct: false, feedback: "Enoxaparina tambi√©n es opci√≥n clase I" },
                    { text: "Fondaparinux preferido", correct: false, feedback: "Requiere HNF adicional en ICP" },
                    { text: "Sin anticoagulaci√≥n hasta cateterismo", correct: false, feedback: "Anticoagulaci√≥n inmediata recomendada" }
                ]
            },
            {
                title: "NSTEMI con Sangrado Alto Riesgo", type: "nstemi",
                scenario: "NSTEMI, historia de sangrado GI reciente, anemia",
                ecg: "üìä ST depresi√≥n lateral üìä",
                question: "¬øEstrategia antitromb√≥tica modificada?",
                options: [
                    { text: "Estrategia invasiva precoz + duraci√≥n DAPT reducida", correct: true, feedback: "Correcto! Invasiva precoz reduce exposici√≥n antitromb√≥tica" },
                    { text: "Solo tratamiento m√©dico", correct: false, feedback: "Invasiva reduce tiempo antitromb√≥tico total" },
                    { text: "DAPT est√°ndar 12 meses", correct: false, feedback: "Alto riesgo hemorr√°gico requiere ajuste" },
                    { text: "Solo ASA sin P2Y12", correct: false, feedback: "DAPT necesario pero duraci√≥n ajustada" }
                ]
            },
            {
                title: "NSTEMI Post-Bypass", type: "nstemi",
                scenario: "NSTEMI en paciente con bypass de 5 a√±os, troponina muy elevada",
                ecg: "üìä Cambios ST en territorio de injerto üìä",
                question: "¬øManejo espec√≠fico requerido?",
                options: [
                    { text: "Cateterismo para evaluar injertos + arterias nativas", correct: true, feedback: "Correcto! Evaluar tanto injertos como progresi√≥n nativa" },
                    { text: "Solo tratamiento m√©dico", correct: false, feedback: "Anatom√≠a post-bypass requiere evaluaci√≥n" },
                    { text: "Re-bypass inmediato", correct: false, feedback: "Cateterismo primero para definir anatom√≠a" },
                    { text: "Mismo manejo que arteria nativa", correct: false, feedback: "Anatom√≠a de injerto requiere consideraciones especiales" }
                ]
            },
            {
                title: "NSTEMI con Diabetes", type: "nstemi",
                scenario: "NSTEMI en diab√©tico tipo 2, HbA1c 9.2%, m√∫ltiples comorbilidades",
                ecg: "üìä Cambios ST m√∫ltiples territorios üìä",
                question: "¬øConsideraci√≥n especial manejo?",
                options: [
                    { text: "Estrategia invasiva favorecida (beneficio mayor en diab√©ticos)", correct: true, feedback: "Correcto! Diab√©ticos se benefician m√°s de estrategia invasiva" },
                    { text: "Manejo conservador por comorbilidades", correct: false, feedback: "Invasiva especialmente beneficiosa en diab√©ticos" },
                    { text: "Mismo manejo que no diab√©ticos", correct: false, feedback: "Diabetes modifica estrategia de manejo" },
                    { text: "Esperar control gluc√©mico", correct: false, feedback: "SCA tiene prioridad sobre control gluc√©mico" }
                ]
            },
            {
                title: "NSTEMI Troponina Muy Elevada", type: "nstemi",
                scenario: "NSTEMI con troponina I >50 ng/mL (>10x LSN), estable hemodin√°micamente",
                ecg: "üìä ST depresi√≥n significativa V4-V6 üìä",
                question: "¬øImplicaci√≥n de troponina muy elevada?",
                options: [
                    { text: "Alto riesgo - invasiva precoz independiente de otros factores", correct: true, feedback: "Correcto! Troponina muy elevada = alto riesgo per se" },
                    { text: "Esperar tendencia de troponina", correct: false, feedback: "Nivel ya define alto riesgo" },
                    { text: "Mismo manejo que troponina baja", correct: false, feedback: "Nivel de troponina modifica riesgo" },
                    { text: "Indica necrosis extensa - manejo conservador", correct: false, feedback: "Alto riesgo requiere estrategia invasiva" }
                ]
            },
            {
                title: "NSTEMI Killip II", type: "nstemi",
                scenario: "NSTEMI con signos de insuficiencia card√≠aca (estertores bibasales, S3)",
                ecg: "üìä ST depresi√≥n anterior extensa üìä",
                question: "¬øClasificaci√≥n e implicaciones?",
                options: [
                    { text: "Killip II - alto riesgo, invasiva precoz + optimizaci√≥n hemodin√°mica", correct: true, feedback: "Correcto! IC en NSTEMI = alto riesgo" },
                    { text: "Killip I - manejo est√°ndar", correct: false, feedback: "Estertores + S3 = Killip II" },
                    { text: "Contraindicaci√≥n para invasiva", correct: false, feedback: "IC es indicaci√≥n para invasiva precoz" },
                    { text: "Esperar compensaci√≥n antes de cateterismo", correct: false, feedback: "Revascularizaci√≥n puede mejorar funci√≥n" }
                ]
            },
            {
                title: "NSTEMI Octogenario", type: "nstemi",
                scenario: "NSTEMI en paciente 82 a√±os, independiente, cognitivamente normal",
                ecg: "üìä ST depresi√≥n inferolateral üìä",
                question: "¬øEstrategia apropiada seg√∫n edad?",
                options: [
                    { text: "Estrategia invasiva - edad sola no es contraindicaci√≥n", correct: true, feedback: "Correcto! Funcionalidad m√°s importante que edad cronol√≥gica" },
                    { text: "Solo tratamiento m√©dico por edad", correct: false, feedback: "Discriminaci√≥n etaria inapropiada" },
                    { text: "Invasiva solo si <80 a√±os", correct: false, feedback: "L√≠mite etario arbitrario no recomendado" },
                    { text: "Manejo paliativo", correct: false, feedback: "Paciente funcional se beneficia de tratamiento activo" }
                ]
            },
            {
                title: "NSTEMI Prevenci√≥n Secundaria", type: "nstemi",
                scenario: "Post-NSTEMI, cateterismo con stent DES, FE 50%, LDL 180 mg/dL",
                ecg: "üìä Resoluci√≥n cambios isqu√©micos post-ICP üìä",
                question: "¬øTerapia estatina al alta?",
                options: [
                    { text: "Estatina alta intensidad (atorvastatina 80mg o rosuvastatina 40mg)", correct: true, feedback: "Correcto! Alta intensidad mandatoria post-SCA" },
                    { text: "Estatina moderada intensidad", correct: false, feedback: "Alta intensidad requerida post-SCA" },
                    { text: "Estatina solo si LDL >190", correct: false, feedback: "Post-SCA requiere estatina independiente de LDL" },
                    { text: "Esperar perfil lip√≠dico en 6 semanas", correct: false, feedback: "Iniciar antes del alta hospitalaria" }
                ]
            }
        ];

        // Seleccionar 10 preguntas aleatorias
        function selectRandomQuestions() {
            const shuffled = [...questionBank].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, 10);
        }

        // Inicializar juego
        function initGame() {
            gameState.patient = patients[Math.floor(Math.random() * patients.length)];
            gameState.selectedQuestions = selectRandomQuestions();
            updatePatientInfo();
            loadStage();
            startTimer();
            updateScore();
        }

        // Actualizar informaci√≥n del paciente
        function updatePatientInfo() {
            const patient = gameState.patient;
            document.getElementById('patientDetails').innerHTML = `
                <strong>${patient.name}</strong> | ${patient.age} a√±os | ${patient.gender}<br>
                <em>${patient.symptoms}</em>
            `;

            const vitalsContainer = document.getElementById('vitalSigns');
            vitalsContainer.innerHTML = '';
            
            for (const [key, data] of Object.entries(patient.vitals)) {
                const vitalDiv = document.createElement('div');
                vitalDiv.className = `vital-sign ${data.critical ? 'critical' : ''}`;
                vitalDiv.innerHTML = `
                    <div class="label">${key}</div>
                    <div class="value">${data.value}</div>
                `;
                vitalsContainer.appendChild(vitalDiv);
            }
        }

        // Cargar etapa actual
        function loadStage() {
            if (gameState.currentStage >= gameState.selectedQuestions.length) {
                endGame();
                return;
            }

            const question = gameState.selectedQuestions[gameState.currentStage];
            const gameArea = document.getElementById('gameArea');
            
            gameArea.innerHTML = `
                <div class="case-type ${question.type}">
                    ${question.type.toUpperCase()} Case
                </div>
                
                <div class="scenario ${question.type}">
                    <h3>üìã ${question.title}</h3>
                    <p>${question.scenario}</p>
                </div>
                
                <div class="ecg-container">
                    <div class="ecg-image">${question.ecg}</div>
                </div>
                
                <h3>${question.question}</h3>
                <div class="options" id="optionsContainer"></div>
                <div class="feedback" id="feedback"></div>
            `;

            // Crear botones de opciones
            const optionsContainer = document.getElementById('optionsContainer');
            question.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerHTML = `${String.fromCharCode(65 + index)}. ${option.text}`;
                btn.onclick = () => checkAnswer(index);
                optionsContainer.appendChild(btn);
            });

            document.getElementById('currentStage').textContent = gameState.currentStage + 1;
            document.getElementById('nextBtn').classList.remove('show');
            document.getElementById('feedback').classList.remove('show');
        }

        // Verificar respuesta
        function checkAnswer(index) {
            const question = gameState.selectedQuestions[gameState.currentStage];
            const option = question.options[index];
            const buttons = document.querySelectorAll('.option-btn');
            const feedback = document.getElementById('feedback');
            
            // Deshabilitar todos los botones
            buttons.forEach(btn => btn.disabled = true);
            
            // Marcar respuesta
            if (option.correct) {
                buttons[index].classList.add('correct');
                feedback.className = 'feedback correct show';
                gameState.score += Math.ceil(gameState.timeRemaining / 6) + 50; // Bonificaci√≥n por tiempo
                gameState.answeredCorrectly.push(gameState.currentStage);
            } else {
                buttons[index].classList.add('incorrect');
                feedback.className = 'feedback incorrect show';
                // Mostrar la respuesta correcta
                question.options.forEach((opt, i) => {
                    if (opt.correct) {
                        buttons[i].classList.add('correct');
                    }
                });
            }
            
            feedback.innerHTML = `
                <strong>${option.correct ? '‚úÖ ¬°Correcto!' : '‚ùå Incorrecto'}</strong><br>
                ${option.feedback}
            `;
            
            updateScore();
            document.getElementById('nextBtn').classList.add('show');
        }

        // Siguiente etapa
        function nextStage() {
            gameState.currentStage++;
            loadStage();
        }

        // Timer
        function startTimer() {
            gameState.timerInterval = setInterval(() => {
                gameState.timeRemaining--;
                updateTimer();
                
                if (gameState.timeRemaining <= 0) {
                    endGame();
                }
            }, 2000);
        }

        function updateTimer() {
            const percentage = (gameState.timeRemaining / gameState.totalTime) * 100;
            document.getElementById('timerFill').style.width = percentage + '%';
            document.getElementById('timerText').textContent = `Tiempo: ${gameState.timeRemaining} min`;
            
            // Cambiar color seg√∫n tiempo restante
            const timerFill = document.getElementById('timerFill');
            if (percentage > 60) {
                timerFill.style.background = 'linear-gradient(90deg, #2ecc71, #27ae60)';
            } else if (percentage > 30) {
                timerFill.style.background = 'linear-gradient(90deg, #f1c40f, #f39c12)';
            } else {
                timerFill.style.background = 'linear-gradient(90deg, #e74c3c, #c0392b)';
            }
        }

        // Actualizar puntuaci√≥n
        function updateScore() {
            document.getElementById('score').textContent = gameState.score;
        }

        // Finalizar juego
        function endGame() {
            clearInterval(gameState.timerInterval);
            
            const gameArea = document.getElementById('gameArea');
            gameArea.style.display = 'none';
            
            const gameOver = document.getElementById('gameOver');
            gameOver.classList.add('show');
            
            const percentage = (gameState.answeredCorrectly.length / 10) * 100;
            document.getElementById('finalScore').textContent = `${gameState.score} puntos (${percentage.toFixed(0)}% correctas)`;
            
            // Logros
            let achievements = [];
            if (percentage === 100) {
                achievements.push("üèÜ Cardi√≥logo Intervencionista");
            } else if (percentage >= 80) {
                achievements.push("‚≠ê Especialista en SCA");
            } else if (percentage >= 60) {
                achievements.push("ü©∫ Conocimiento S√≥lido");
            }
            
            if (gameState.timeRemaining > 45) {
                achievements.push("‚ö° Diagn√≥stico R√°pido");
            }
            if (gameState.score > 800) {
                achievements.push("üíé Puntuaci√≥n Excelente");
            }
            
            // Contar casos STEMI vs NSTEMI correctos
            let stemiCorrect = 0, nstemiCorrect = 0;
            gameState.answeredCorrectly.forEach(index => {
                if (gameState.selectedQuestions[index].type === 'stemi') stemiCorrect++;
                else nstemiCorrect++;
            });
            
            if (stemiCorrect >= 4) achievements.push("üö® Experto STEMI");
            if (nstemiCorrect >= 4) achievements.push("üìä Experto NSTEMI");
            
            document.getElementById('achievements').innerHTML = achievements
                .map(a => `<span class="achievement">${a}</span>`)
                .join('');
            
            // Mensaje final
            let message = "";
            if (percentage === 100) {
                message = "¬°Excelente! Dominas perfectamente el manejo de s√≠ndromes coronarios agudos seg√∫n las gu√≠as AHA 2025. Tu conocimiento salvar√° vidas.";
            } else if (percentage >= 80) {
                message = "¬°Muy bien! Tienes un s√≥lido conocimiento del manejo de STEMI y NSTEMI. Peque√±os ajustes te llevar√°n a la excelencia.";
            } else if (percentage >= 60) {
                message = "Buen conocimiento base. Revisa las √°reas donde tuviste dificultades, especialmente timing y estratificaci√≥n de riesgo.";
            } else if (percentage >= 40) {
                message = "Conocimiento b√°sico presente. Necesitas estudiar m√°s las gu√≠as actualizadas de manejo de SCA.";
            } else {
                message = "Requieres estudio intensivo de las gu√≠as AHA 2025. Recuerda: en SCA, las decisiones correctas salvan vidas y m√∫sculo card√≠aco.";
            }
            
            document.getElementById('finalMessage').textContent = message;
        }

        // Reiniciar juego
        function restartGame() {
            gameState = {
                score: 0,
                currentStage: 0,
                totalTime: 60,
                timeRemaining: 60,
                timerInterval: null,
                answeredCorrectly: [],
                patient: null,
                selectedQuestions: []
            };
            
            document.getElementById('gameArea').style.display = 'block';
            document.getElementById('gameOver').classList.remove('show');
            
            initGame();
        }

        // Iniciar al cargar
        window.onload = initGame;
    </script>
</body>
</html>